<h3>Phenotypes</h3>

<div class="mt-3" *ngIf="gene">
  <div class="mb-3">
    <mat-slide-toggle
      [checked]="showOnlyBest"
      (change)="showOnlyBest = !showOnlyBest"
      color="primary"
    >
      Show only best DIOPT score gene
    </mat-slide-toggle>
  </div>
  <div id="phenotypes-vis" class="mb-3 mr-3"
    [ngStyle]="{ 'height': (showOnlyBest ? bestHeight : height) + 'px' }"
    (mouseleave)="mouseoverCat = null"
  >
    <div class="org-row org-row-header">
      <div class="org-icon-wrapper"></div>
      <div class="org-name-wrapper"></div>
      <div class="org-gene-wrapper">Gene</div>
      <div class="org-diopt-score-wrapper">DIOPT Score</div>
      <div class="org-best-wrapper">Best Score</div>
      <div class="org-header-cell-wrapper"
        *ngFor="let cat of categories"
      >
        <img src="../../../../../assets/icons/{{ catNameToIcon[cat.name] }}.svg"
          [ngClass]="{ 'accent': mouseoverCat === cat.name }"
          [matTooltip]="cat.name"
          (mouseenter)="selectCategory(null, null, cat.name, true)"
        >
      </div>
    </div>

    <div class="org-row">
      <div class="org-icon-wrapper">
        <img src="../../../../../assets/icons/001-user.svg">
      </div>
      <div class="org-name-wrapper">
        <span>
          Human
        </span>
      </div>
      <div class="org-gene-wrapper">
        <span>
          {{ gene.symbol }}
        </span>
      </div>
      <div class="org-diopt-score-wrapper"></div>
      <div class="org-best-wrapper"></div>
      <div
        *ngFor="let cat of categories"
      >
        <div class="org-cat-cell-wrapper org-cell-bg-blue"
          *ngIf="phenotypes['human'] && phenotypes['human'][cat.name] && phenotypes['human'][cat.name].length"
          [matTooltip]="phenotypes['human'][cat.name].length + ' phenotypes'"
          (click)="selectCategory('human', null, cat.name)"
          [ngClass]="{ 'mouseover': cat.name === mouseoverCat, 'selected': selected && selected.org === 'human' && selected.category === cat.name }"
          (mouseenter)="selectCategory('human', null, cat.name, true)"
        ></div>
        <div class="org-cat-cell-wrapper"
          *ngIf="!phenotypes['human'] || !phenotypes['human'][cat.name] || !phenotypes['human'][cat.name].length"
          [ngClass]="{ 'mouseover': cat.name === mouseoverCat, 'org-cell-bg-gray': !phenotypes['human'] }"
          (mouseenter)="selectCategory('human', null, cat.name, true)"
        ></div>
      </div>
    </div>

    <!-- Mouse phenotype starts -->
    <div 
      *ngFor="let aGenePheno of phenotypes['mouse']; index as idx"
    >
      <div class="org-row"
        *ngIf="!showOnlyBest || aGenePheno.bestScore"
        [@toggle]="!showOnlyBest || aGenePheno.bestScore"
      >
        <div class="org-icon-wrapper">
          <img src="../../../../../assets/icons/002-mouse.svg">
        </div>
        <div class="org-name-wrapper">
          <span>
            Mouse
          </span>
        </div>
        <div class="org-gene-wrapper">
          <span>
            <a href="http://www.informatics.jax.org/marker/{{ aGenePheno.gene.mgiId }}" target="_blank">
              {{ aGenePheno.gene.symbol }}
            </a>
          </span>
        </div>
        <div class="org-diopt-score-wrapper text-right">
          <span>
            {{ aGenePheno.score }}/16
          </span>
        </div>
        <div class="org-best-wrapper text-center">
          <span [ngClass]="{ 'text-bold-blue': aGenePheno.bestScore }">
            {{ aGenePheno.bestScore ? 'Y' : 'N' }}
          </span>
        </div>
        <div *ngFor="let cat of categories">
          <div class="org-cat-cell-wrapper org-cell-bg-blue"
            *ngIf="aGenePheno.phenotypes && aGenePheno.phenotypes[cat.name] && aGenePheno.phenotypes[cat.name].length"
            [matTooltip]="aGenePheno.phenotypes[cat.name].length + ' phenotypes'"
            (click)="selectCategory('mouse', idx, cat.name)"
            [ngClass]="{ 'mouseover': cat.name === mouseoverCat, 'selected': selected && selected.org === 'mouse' && selected.idx === idx && selected.category === cat.name }"
            (mouseenter)="selectCategory('mouse', null, cat.name, true)"
          ></div>
          <div class="org-cat-cell-wrapper"
            *ngIf="!aGenePheno.phenotypes || !aGenePheno.phenotypes[cat.name] || !aGenePheno.phenotypes[cat.name].length"
            [ngClass]="{ 'mouseover': cat.name === mouseoverCat, 'org-cell-bg-gray': !aGenePheno.phenotypes }"
            (mouseenter)="selectCategory('mouse', null, cat.name, true)"
          ></div>
        </div>
      </div>
    </div>
    <!-- Mouse phenotype ends -->

    <!-- Worm phenotype starts -->
    <div 
      *ngFor="let aGenePheno of phenotypes['worm']; index as idx"
    >
      <div class="org-row"
        [@toggle]="!showOnlyBest || aGenePheno.bestScore"
      >
        <div class="org-icon-wrapper">
          <img src="../../../../../assets/icons/006-worm.svg">
        </div>
        <div class="org-name-wrapper">
          <span>
            Worm
          </span>
        </div>
        <div class="org-gene-wrapper">
          <span>
            <a href="http://www.informatics.jax.org/marker/{{ aGenePheno.gene.mgiId }}" target="_blank">
              {{ aGenePheno.gene.symbol }}
            </a>
          </span>
        </div>
        <div class="org-diopt-score-wrapper text-right">
          <span>
            {{ aGenePheno.score }}/16
          </span>
        </div>
        <div class="org-best-wrapper text-center">
          <span [ngClass]="{ 'text-bold-blue': aGenePheno.bestScore }">
            {{ aGenePheno.bestScore ? 'Y' : 'N' }}
          </span>
        </div>
        <div *ngFor="let cat of categories">
          <div class="org-cat-cell-wrapper org-cell-bg-blue"
            *ngIf="aGenePheno.phenotypes && aGenePheno.phenotypes[cat.name] && aGenePheno.phenotypes[cat.name].length"
            [matTooltip]="aGenePheno.phenotypes[cat.name].length + ' phenotypes'"
            (click)="selectCategory('worm', idx, cat.name)"
            [ngClass]="{ 'mouseover': cat.name === mouseoverCat, 'selected': selected && selected.org === 'worm' && selected.idx === idx && selected.category === cat.name }"
            (mouseenter)="selectCategory('worm', null, cat.name, true)"
          ></div>
          <div class="org-cat-cell-wrapper"
            *ngIf="!aGenePheno.phenotypes || !aGenePheno.phenotypes[cat.name] || !aGenePheno.phenotypes[cat.name].length"
            [ngClass]="{ 'mouseover': cat.name === mouseoverCat, 'org-cell-bg-gray': !aGenePheno.phenotypes }"
            (mouseenter)="selectCategory('worm', null, cat.name, true)"
          ></div>
        </div>
      </div>
    </div>
    <!-- Worm phenotype ends -->

  </div>

  <div class="phenotypes-detail"
    *ngIf="selected && selected.org === 'mouse'"
  >
    <h4 class="mt-0">Mammalian Phenotypes associated with {{ phenotypes[selected.org][selected.idx].gene.symbol }} related to {{ selected.category }}</h4>
    <ul>
      <li
        *ngFor="let mp of phenotypes[selected.org][selected.idx].phenotypes[selected.category]"
        class="text-capitalize"
      >{{ mp.name }}</li>
    </ul>
  </div>

  <div class="phenotypes-detail"
    *ngIf="selected && selected.org === 'human'"
  >
    <h4 class="mt-0">Human Phenotypes associated with {{ gene.symbol }} related to {{ selected.category }}</h4>
    <ul>
      <li
        *ngFor="let hpo of phenotypes[selected.org][selected.category]"
        class="text-capitalize"
      >
        <a href="https://hpo.jax.org/app/browse/term/{{ hpo.id }}" target="_blank">
          {{ hpo.name }}
        </a>
      </li>
    </ul>
  </div>
</div>