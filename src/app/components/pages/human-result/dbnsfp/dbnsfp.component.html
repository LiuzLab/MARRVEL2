<div class="row mb-3">
  <div class="col-12">
    <h3 class="d-inline-block align-middle">
      Variant Functional Prediction Scores of
      Chr{{ variant.chr }}:{{ variant.pos }} {{ variant.ref }}&gt;{{ variant.alt }}
      from dbNSFP
    </h3>
  </div>

  <div class="col-12 mt-3" *ngIf="!loading && data && rankAverage != null" [@toggle]>
    <div class="d-table comment">
      <div class="d-table-cell align-top comment-icon-wrapper">
        <mat-icon matTooltip="MARRVEL's comment" matTooltipPosition="above">insert_comment</mat-icon>
      </div>

      <span class="d-table-cell pl-2">
        For Chr{{ variant.chr }}:{{ variant.pos }} {{ variant.ref }}&gt;{{ variant.alt }},
        the average dbNSFP rank score is {{ rankAverage.toFixed(3) }}.
        This means that Chr{{ variant.chr }}:{{ variant.pos }} {{ variant.ref }}&gt;{{ variant.alt }}
        is <strong>more likely to be damaging
        than {{ (rankAverage * 100).toFixed(1) }}% of all possible coding variants</strong>.
      </span>
    </div>
  </div>
</div>

<div class="row" *ngIf="!loading && !data">
  <div class="col-12">
    <p class="m-0">No data found for Chr{{ variant.chr }}:{{ variant.pos }} {{ variant.ref }}&gt;{{ variant.alt }}</p>
  </div>
</div>

<div class="row" *ngIf="!loading && data">
  <div class="col-12">
    <table class="mat-table w-100">
      <thead>
        <tr class="mat-header-row">
          <th class="mat-header-cell">
            Prediction tool
          </th>
          <th class="mat-header-cell number nowrap-fit-cell">
            Score / Prediction
          </th>
          <th class="mat-header-cell">
            <span class="text-underline-dashed" matTooltip="The Rank Score is provided by dbNSFP to allow comparison between different scores. It is between 0 and 1 and a score of 0.9 means it is more likely to be damaging than 90% of all potential nsSNVs predicted by that method.">
              dbNSFP Rank Score
            </span>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Uses 63 annotations (949 features)."
            >
              CADD phred
            </span>
            <span class="ml-1 badge badge-secondary">v1.4</span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed"
              *ngIf="data.scores.CADD && data.scores.CADD.phred"
              matTooltip="Range = 0 (least damaging) to 50 (most damaging)"
            >
              {{ data.scores.CADD.phred }}&nbsp;
            </span>
            <span class="text-muted" *ngIf="!data.scores.CADD || !data.scores.CADD.phred">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.CADD && data.scores.CADD.phred"
              [rankscore]="data.scores.CADD.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Ensemble method of 13 tools."
            >
              REVEL
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed" *ngIf="data.scores.REVEL && data.scores.REVEL.score"
              matTooltip="Range = 0 (least damaging) to 1 (most damaging)"
            >
              {{ data.scores.REVEL.score }}
            </span>
            <span class="text-muted" *ngIf="!data.scores.REVEL || !data.scores.REVEL.score">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.REVEL && data.scores.REVEL.score"
              [rankscore]="data.scores.REVEL.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Uses conservation data and trained on mutations linked to Mendelian diseases."
            >
              M-CAP
              <span class="ml-1 badge badge-secondary">v1.3</span>
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed" *ngIf="data.scores.MCAP && data.scores.MCAP.prediction"
              matTooltip="Possible scores are: Tolerated or Damaging"
            >
              {{ data.scores.MCAP.prediction }}
            </span>
            <span class="text-muted" *ngIf="!data.scores.MCAP || !data.scores.MCAP.prediction">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.MCAP && data.scores.MCAP.prediction"
              [rankscore]="data.scores.MCAP.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Uses eight sequence-based and three structure-based predictive features. Trained with Mendelian disease mutations and SNVs from close mammalian homolog proteins."
            >
              Polyphen-2 HumDiv
              <span class="ml-1 badge badge-secondary">v2.2.2</span>
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed"
              *ngIf="data.scores.Polyphen2HDIV && data.scores.Polyphen2HDIV.prediction"
              matTooltip="Possible scores are: Benign, Possibly Damaging, and Probably Damaging"
            >
              {{ data.scores.Polyphen2HDIV.prediction }}
            </span>
            <span class="text-muted" *ngIf="!data.scores.Polyphen2HDIV || !data.scores.Polyphen2HDIV.prediction">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.Polyphen2HDIV && data.scores.Polyphen2HDIV.prediction"
              [rankscore]="data.scores.Polyphen2HDIV.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Uses eight sequence-based and three structure-based predictive features. Trained with disease associated and common SNVs."
            >
              Polyphen-2 HumVar
              <span class="ml-1 badge badge-secondary">v2.2.2</span>
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed number"
              *ngIf="data.scores.Polyphen2HVAR && data.scores.Polyphen2HVAR.prediction"
              matTooltip="Possible scores are: Benign, Possibly Damaging, and Probably Damaging"
            >
              {{ data.scores.Polyphen2HVAR.prediction }}
            </span>
            <span class="text-muted" *ngIf="!data.scores.Polyphen2HVAR || !data.scores.Polyphen2HVAR.prediction">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.Polyphen2HVAR && data.scores.Polyphen2HVAR.prediction"
              [rankscore]="data.scores.Polyphen2HVAR.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Uses multiple alignments and phylogenetic tree of 34 mammals."
            >
              GERP++
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed number"
              *ngIf="data.scores['GERP++RS'] && data.scores['GERP++RS'].score"
              matTooltip="-12.3 (least conserved) to 6.17 (most conserved)"
            >{{ data.scores['GERP++RS'].score }}</span>&nbsp;
            <span class="text-muted number" *ngIf="!data.scores['GERP++RS'] || !data.scores['GERP++RS'].score">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores['GERP++RS'] && data.scores['GERP++RS'].score"
              [rankscore]="data.scores['GERP++RS'].rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="Uses multiple alignments and phylogenetic tree of 100 vertebrates."
            >
              phyloP 100way Vertebrate
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed"
              *ngIf="data.scores.phyloP100wayVertebrate && data.scores.phyloP100wayVertebrate.score"
              matTooltip="Range =- 20.0 (least conserved) to 10.003 (most conserved)"
            >
              {{ data.scores.phyloP100wayVertebrate.score }}
            </span>
            <span class="text-muted" *ngIf="!data.scores.phyloP100wayVertebrate || !data.scores.phyloP100wayVertebrate.score">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.phyloP100wayVertebrate && data.scores.phyloP100wayVertebrate.score"
              [rankscore]="data.scores.phyloP100wayVertebrate.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>

        <tr class="mat-row">
          <td class="mat-cell">
            <span class="text-underline-dashed"
              matTooltip="conservation score based on the multiple alignments of 30 mammalian genomes (including human)."
            >
                phyloP 30way Mammalian
            </span>
          </td>
          <td class="mat-cell number">
            <span class="text-underline-dashed"
              *ngIf="data.scores.phyloP30wayMammalian && data.scores.phyloP30wayMammalian.score"
              matTooltip="Scores range from -20 to 1.312. The larger the score, the more conserved the site."
            >
              {{ data.scores.phyloP30wayMammalian.score }}
            </span>
            <span class="text-muted" *ngIf="!data.scores.phyloP30wayMammalian || !data.scores.phyloP30wayMammalian.score">NA</span>
          </td>
          <td class="mat-cell">
            <app-rankscore-visual
              *ngIf="data.scores.phyloP30wayMammalian && data.scores.phyloP30wayMammalian.score"
              [rankscore]="data.scores.phyloP30wayMammalian.rankscore"
            ></app-rankscore-visual>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>